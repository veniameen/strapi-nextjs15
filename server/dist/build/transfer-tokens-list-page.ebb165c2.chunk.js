"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[314],{12186:(Y,h,t)=>{t.d(h,{A:()=>c});var e=t(96540),a=t(88920),I=t(15912),m=t(69782),k=t(97939),O=t(98016),l=t(78320),U=t(5556),n=t.n(U),L=t(6442),B=t(56347),M=t(91616),W=t(63292),A=t(34487);const P=({tokenName:o,onClickDelete:i,tokenType:v})=>{const{formatMessage:g}=(0,L.A)(),{trackUsage:T}=(0,l.z1)(),[p,y]=(0,e.useState)(!1),u=()=>{y(!1),T("willDeleteToken",{tokenType:v}),i()};return e.createElement(M.a,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(W.K,{onClick:()=>{y(!0)},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${o}`}),name:"delete",noBorder:!0,icon:e.createElement(A.A,null)}),e.createElement(l.TM,{onToggleDialog:()=>y(!1),onConfirm:u,isOpen:p}))};P.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const Q=P;var $=t(89376),G=t(40948);const z={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},J=(0,G.Ay)(l.N_)`
  svg {
    path {
      fill: ${({theme:o})=>o.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:o})=>o.colors.neutral800};
      }
    }
  }
`,S=({tokenName:o,tokenId:i,buttonType:v,children:g})=>{const{formatMessage:T}=(0,L.A)(),{location:{pathname:p}}=(0,B.W6)();return e.createElement(J,{to:`${p}/${i}`,title:T(z[v],{target:o})},g)};S.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},S.defaultProps={buttonType:"edit"};const C=S,f=({tokenName:o,tokenId:i})=>e.createElement(C,{tokenName:o,tokenId:i,buttonType:"read"},e.createElement($.A,null));f.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const E=f;var F=t(46748);const R=({tokenName:o,tokenId:i})=>e.createElement(C,{tokenName:o,tokenId:i},e.createElement(F.A,null));R.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const j=R,D=({permissions:o,headers:i,contentType:v,isLoading:g,tokens:T,onConfirmDelete:p,tokenType:y})=>{const{canDelete:u,canUpdate:d,canRead:V}=o,N=u||d||V,[{query:x}]=(0,l.sq)(),{formatMessage:b}=(0,L.A)(),[,w]=x?x.sort.split(":"):"ASC",{push:H,location:{pathname:K}}=(0,B.W6)(),{trackUsage:s}=(0,l.z1)(),Z=T.sort((r,q)=>{const X=r.name.localeCompare(q.name);return w==="DESC"?-X:X});return e.createElement(l.Ee,{headers:i,contentType:v,rows:T,withBulkActions:N,isLoading:g,onConfirmDelete:p},e.createElement(a.N,null,Z.map(r=>e.createElement(I.Tr,{key:r.id,...(0,l.qM)({fn(){s("willEditTokenFromList",{tokenType:y}),H(`${K}/${r.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,l.a8)(250)},e.createElement(k.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},r.name)),e.createElement(m.Td,{maxWidth:(0,l.a8)(250)},e.createElement(k.o,{textColor:"neutral800",ellipsis:!0},r.description)),e.createElement(m.Td,null,e.createElement(k.o,{textColor:"neutral800"},e.createElement(l.sR,{timestamp:new Date(r.createdAt)}))),e.createElement(m.Td,null,r.lastUsedAt&&e.createElement(k.o,{textColor:"neutral800"},e.createElement(l.sR,{timestamp:new Date(r.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:b({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),N&&e.createElement(m.Td,null,e.createElement(O.s,{justifyContent:"end"},d&&e.createElement(j,{tokenName:r.name,tokenId:r.id}),!d&&V&&e.createElement(E,{tokenName:r.name,tokenId:r.id}),u&&e.createElement(Q,{tokenName:r.name,onClickDelete:()=>p(r.id),tokenType:y})))))))};D.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},D.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const c=D},55286:(Y,h,t)=>{t.d(h,{I:()=>e,j:()=>a});const e="api-token",a="transfer-token"},12837:(Y,h,t)=>{t.r(h),t.d(h,{default:()=>S});var e=t(96540),a=t(78320),I=t(69733),m=t(71526),k=t(71808),O=t(7562),l=t(40121),U=t(68433),n=t(55373),L=t.n(n),B=t(6442),M=t(75942),W=t(56347),A=t(55286),P=t(12186);const $=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],z=()=>{(0,a.L4)();const C=(0,M.useQueryClient)(),{formatMessage:f}=(0,B.A)(),E=(0,a.hN)(),F=(0,I.d4)(m.G),{allowedActions:{canCreate:R,canDelete:j,canUpdate:D,canRead:c}}=(0,a.ec)(F.settings["transfer-tokens"]),{push:o}=(0,W.W6)(),{trackUsage:i}=(0,a.z1)(),{startSection:v}=(0,a.Cx)(),g=(0,e.useRef)(v),{get:T,del:p}=(0,a.ry)();(0,e.useEffect)(()=>{g.current&&g.current("transferTokens")},[]),(0,e.useEffect)(()=>{o({search:L().stringify({sort:"name:ASC"},{encode:!1})})},[o]);const y=$.map(s=>({...s,metadatas:{...s.metadatas,label:f(s.metadatas.label)}})),{data:u,status:d,isFetching:V}=(0,M.useQuery)(["transfer-tokens"],async()=>{i("willAccessTokenList",{tokenType:A.j});const{data:{data:s}}=await T("/admin/transfer/tokens");return i("didAccessTokenList",{number:s.length,tokenType:A.j}),s},{enabled:c,onError(s){console.log("error",s),s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),N=c&&(d!=="success"&&d!=="error"||d==="success"&&V),x=(0,M.useMutation)(async s=>{await p(`/admin/transfer/tokens/${s}`)},{async onSuccess(){await C.invalidateQueries(["transfer-tokens"])},onError(s){s?.response?.data?.data?E({type:"warning",message:s.response.data.data}):s?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?E({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):E({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),b=u&&u?.length>0,w=c&&b,H=c&&!b&&!R,K=c&&!b&&R;return e.createElement(k.g,{"aria-busy":N},e.createElement(a.x7,{name:"Transfer Tokens"}),e.createElement(O.Q,{title:f({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:f({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:R?e.createElement(a.z9,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(U.A,null),size:"S",onClick:()=>i("willAddTokenFromList",{tokenType:A.j}),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(l.s,null,!c&&e.createElement(a.UW,null),w&&e.createElement(P.A,{permissions:{canRead:c,canDelete:j,canUpdate:D},headers:y,contentType:"trasfer-tokens",rows:u,isLoading:N,onConfirmDelete:s=>x.mutateAsync(s),tokens:u,tokenType:A.j}),K&&e.createElement(a.R1,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(a.z9,{variant:"secondary",startIcon:e.createElement(U.A,null),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),H&&e.createElement(a.R1,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},S=()=>{const C=(0,I.d4)(m.G);return e.createElement(a.kz,{permissions:C.settings["transfer-tokens"].main},e.createElement(z,null))}}}]);
