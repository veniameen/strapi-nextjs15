"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[1007],{12186:(K,E,t)=>{t.d(E,{A:()=>p});var e=t(96540),a=t(88920),b=t(15912),m=t(69782),A=t(97939),O=t(98016),i=t(78320),P=t(5556),n=t.n(P),R=t(6442),N=t(56347),L=t(91616),W=t(63292),h=t(34487);const U=({tokenName:s,onClickDelete:r,tokenType:y})=>{const{formatMessage:g}=(0,R.A)(),{trackUsage:T}=(0,i.z1)(),[f,c]=(0,e.useState)(!1),C=()=>{c(!1),T("willDeleteToken",{tokenType:y}),r()};return e.createElement(L.a,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(W.K,{onClick:()=>{c(!0)},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${s}`}),name:"delete",noBorder:!0,icon:e.createElement(h.A,null)}),e.createElement(i.TM,{onToggleDialog:()=>c(!1),onConfirm:C,isOpen:f}))};U.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};const Y=U;var $=t(89376),j=t(40948);const z={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},J=(0,j.Ay)(i.N_)`
  svg {
    path {
      fill: ${({theme:s})=>s.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:s})=>s.colors.neutral800};
      }
    }
  }
`,D=({tokenName:s,tokenId:r,buttonType:y,children:g})=>{const{formatMessage:T}=(0,R.A)(),{location:{pathname:f}}=(0,N.W6)();return e.createElement(J,{to:`${f}/${r}`,title:T(z[y],{target:s})},g)};D.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},D.defaultProps={buttonType:"edit"};const k=D,u=({tokenName:s,tokenId:r})=>e.createElement(k,{tokenName:s,tokenId:r,buttonType:"read"},e.createElement($.A,null));u.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const B=u;var F=t(46748);const v=({tokenName:s,tokenId:r})=>e.createElement(k,{tokenName:s,tokenId:r},e.createElement(F.A,null));v.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};const H=v,S=({permissions:s,headers:r,contentType:y,isLoading:g,tokens:T,onConfirmDelete:f,tokenType:c})=>{const{canDelete:C,canUpdate:d,canRead:x}=s,M=C||d||x,[{query:V}]=(0,i.sq)(),{formatMessage:I}=(0,R.A)(),[,Q]=V?V.sort.split(":"):"ASC",{push:w,location:{pathname:G}}=(0,N.W6)(),{trackUsage:o}=(0,i.z1)(),Z=T.sort((l,q)=>{const X=l.name.localeCompare(q.name);return Q==="DESC"?-X:X});return e.createElement(i.Ee,{headers:r,contentType:y,rows:T,withBulkActions:M,isLoading:g,onConfirmDelete:f},e.createElement(a.N,null,Z.map(l=>e.createElement(b.Tr,{key:l.id,...(0,i.qM)({fn(){o("willEditTokenFromList",{tokenType:c}),w(`${G}/${l.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,i.a8)(250)},e.createElement(A.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},l.name)),e.createElement(m.Td,{maxWidth:(0,i.a8)(250)},e.createElement(A.o,{textColor:"neutral800",ellipsis:!0},l.description)),e.createElement(m.Td,null,e.createElement(A.o,{textColor:"neutral800"},e.createElement(i.sR,{timestamp:new Date(l.createdAt)}))),e.createElement(m.Td,null,l.lastUsedAt&&e.createElement(A.o,{textColor:"neutral800"},e.createElement(i.sR,{timestamp:new Date(l.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:I({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),M&&e.createElement(m.Td,null,e.createElement(O.s,{justifyContent:"end"},d&&e.createElement(H,{tokenName:l.name,tokenId:l.id}),!d&&x&&e.createElement(B,{tokenName:l.name,tokenId:l.id}),C&&e.createElement(Y,{tokenName:l.name,onClickDelete:()=>f(l.id),tokenType:c})))))))};S.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},S.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const p=S},55286:(K,E,t)=>{t.d(E,{I:()=>e,j:()=>a});const e="api-token",a="transfer-token"},48977:(K,E,t)=>{t.r(E),t.d(E,{default:()=>D});var e=t(96540),a=t(78320),b=t(69733),m=t(71526),A=t(71808),O=t(7562),i=t(40121),P=t(68433),n=t(55373),R=t.n(n),N=t(6442),L=t(75942),W=t(56347),h=t(55286),U=t(12186);const $=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],z=()=>{(0,a.L4)();const k=(0,L.useQueryClient)(),{formatMessage:u}=(0,N.A)(),B=(0,a.hN)(),F=(0,b.d4)(m.G),{allowedActions:{canCreate:v,canDelete:H,canUpdate:S,canRead:p}}=(0,a.ec)(F.settings["api-tokens"]),{push:s}=(0,W.W6)(),{trackUsage:r}=(0,a.z1)(),{startSection:y}=(0,a.Cx)(),g=e.useRef(y),{get:T,del:f}=(0,a.ry)(),{formatAPIError:c}=(0,a.wq)();e.useEffect(()=>{g.current&&g.current("apiTokens")},[]),e.useEffect(()=>{s({search:R().stringify({sort:"name:ASC"},{encode:!1})})},[s]);const C=$.map(o=>({...o,metadatas:{...o.metadatas,label:u(o.metadatas.label)}})),{data:d,isLoading:x}=(0,L.useQuery)(["api-tokens"],async()=>{r("willAccessTokenList",{tokenType:h.I});const{data:{data:o}}=await T("/admin/api-tokens");return r("didAccessTokenList",{number:o.length,tokenType:h.I}),o},{cacheTime:0,enabled:p,onError(o){B({type:"warning",message:c(o)})}}),M=x,V=(0,L.useMutation)(async o=>{await f(`/admin/api-tokens/${o}`)},{async onSuccess(){await k.invalidateQueries(["api-tokens"]),r("didDeleteToken")},onError(o){B({type:"warning",message:c(o)})}}),I=d&&d.length>0,Q=p&&I,w=p&&!I&&!v,G=p&&!I&&v;return e.createElement(A.g,{"aria-busy":M},e.createElement(a.x7,{name:"API Tokens"}),e.createElement(O.Q,{title:u({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:u({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:v&&e.createElement(a.z9,{"data-testid":"create-api-token-button",startIcon:e.createElement(P.A,null),size:"S",onClick:()=>r("willAddTokenFromList",{tokenType:h.I}),to:"/settings/api-tokens/create"},u({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"}))}),e.createElement(i.s,null,!p&&e.createElement(a.UW,null),Q&&e.createElement(U.A,{permissions:{canRead:p,canDelete:H,canUpdate:S},headers:C,contentType:"api-tokens",rows:d,isLoading:M,onConfirmDelete:o=>V.mutateAsync(o),tokens:d,tokenType:h.I}),G&&e.createElement(a.R1,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(a.z9,{variant:"secondary",startIcon:e.createElement(P.A,null),to:"/settings/api-tokens/create"},u({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),w&&e.createElement(a.R1,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},D=()=>{const k=(0,b.d4)(m.G);return e.createElement(a.kz,{permissions:k.settings["api-tokens"].main},e.createElement(z,null))}}}]);
