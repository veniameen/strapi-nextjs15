"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[8809],{91280:(ge,y,t)=>{t.r(y),t.d(y,{default:()=>Z});var e=t(96540),i=t(78320),u=t(69733),B=t(71526),O=t(90954),m=t(98016),V=t(10457),E=t(97939),K=t(26437),d=t(7425),x=t(63560),z=t.n(x),N=t(6442),P=t(75942),Y=t(56347),j=t(30420),$=t(30127),G=t(20022),k=t(45683),f=t(89974),c=t(59984),J=t(45410),Q=t(42570),n=t(11714),U=t(78101),S=t(18960),H=t(41090);function X(){const{formatMessage:s}=(0,N.A)(),{post:b}=(0,i.ry)(),{push:q}=(0,Y.W6)(),{formatAPIError:_}=(0,i.wq)(),w=(0,u.wA)(),M=(0,i.hN)(),{collectionTypes:ee,singleTypes:te,isLoading:oe}=(0,j.m)(),{isLoading:L,meta:v,workflows:T}=(0,U.W)(),{clientState:{currentWorkflow:{data:l,isDirty:se}}}=(0,u.d4)(o=>o?.[n.p6]??S.u),[C,g]=e.useState(!1),{isLoading:W,getFeature:ne}=(0,G.b)(),[ae,le]=e.useState(null),[I,h]=e.useState({}),a=ne("review-workflows"),A=T.flatMap(o=>o.contentTypes),{mutateAsync:re,isLoading:D}=(0,P.useMutation)(async({workflow:o})=>{const{data:{data:r}}=await b("/admin/review-workflows/workflows",{data:o});return r},{onSuccess(){M({type:"success",message:{id:"Settings.review-workflows.create.page.notification.success",defaultMessage:"Workflow successfully created"}})}}),R=async()=>{h({});try{const o=await re({workflow:l});return q(`/settings/review-workflows/${o.id}`),o}catch(o){return o.response.data?.error?.name==="ValidationError"&&o.response.data?.error?.details?.errors?.length>0&&le(o.response.data?.error?.details?.errors.reduce((r,F)=>(z()(r,F.path,F.message),r),{})),M({type:"warning",message:_(o)}),null}},ie=async()=>{await R()},ce=()=>{h({})},p=(0,d.Wx)({enableReinitialize:!0,initialErrors:ae,initialValues:l,async onSubmit(){const o=l.contentTypes.some(r=>A.includes(r));a?.[n.hK]&&v?.workflowCount>=parseInt(a[n.hK],10)?g("workflow"):a?.[n.Dp]&&l.stages.length>=parseInt(a[n.Dp],10)?g("stage"):o?h(r=>({...r,hasReassignedContentTypes:!0})):R()},validate(o){return(0,H._)({values:o,formatMessage:s})}});return(0,$.N)(n.p6,S.F),e.useEffect(()=>{w((0,k.JU)()),w((0,k.mF)({name:""}))},[w]),e.useEffect(()=>{!L&&!W&&(a?.[n.hK]&&v?.workflowsTotal>=parseInt(a[n.hK],10)?g("workflow"):a?.[n.Dp]&&l.stages.length>=parseInt(a[n.Dp],10)&&g("stage"))},[W,L,a,v?.workflowsTotal,l.stages.length]),e.createElement(e.Fragment,null,e.createElement(f.nh,null),e.createElement(d.QI,{value:p},e.createElement(d.lV,{onSubmit:p.handleSubmit},e.createElement(f.Y9,{navigationAction:e.createElement(f.kc,{href:"/settings/review-workflows"}),primaryAction:e.createElement(O.$,{startIcon:e.createElement(K.A,null),type:"submit",size:"M",disabled:!se,isLoading:D},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.review-workflows.create.page.title",defaultMessage:"Create Review Workflow"}),subtitle:s({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:l?.stages?.length??0})}),e.createElement(f.bL,null,e.createElement(m.s,{alignItems:"stretch",direction:"column",gap:7},oe?e.createElement(V.a,null,s({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})):e.createElement(m.s,{alignItems:"stretch",direction:"column",gap:7},e.createElement(Q.r,{contentTypes:{collectionTypes:ee,singleTypes:te},workflows:T}),e.createElement(J.e,{stages:p.values?.stages})))))),e.createElement(i.TM.Root,{isConfirmButtonLoading:D,isOpen:Object.keys(I).length>0,onToggleDialog:ce,onConfirm:ie},e.createElement(i.TM.Body,null,e.createElement(m.s,{direction:"column",gap:5},I.hasReassignedContentTypes&&e.createElement(E.o,{textAlign:"center",variant:"omega"},s({id:"Settings.review-workflows.page.delete.confirm.contentType.body",defaultMessage:"{count} {count, plural, one {content-type} other {content-types}} {count, plural, one {is} other {are}} already mapped to {count, plural, one {another workflow} other {other workflows}}. If you save changes, {count, plural, one {this} other {these}} {count, plural, one {content-type} other {{count} content-types}} will no more be mapped to the {count, plural, one {another workflow} other {other workflows}} and all corresponding information will be removed."},{count:A.filter(o=>l.contentTypes.includes(o)).length})),e.createElement(E.o,{textAlign:"center",variant:"omega"},s({id:"Settings.review-workflows.page.delete.confirm.confirm",defaultMessage:"Are you sure you want to save?"}))))),e.createElement(c.bL,{isOpen:C==="workflow",onClose:()=>g(!1)},e.createElement(c.hE,null,s({id:"Settings.review-workflows.create.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})),e.createElement(c.nB,null,s({id:"Settings.review-workflows.create.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."}))),e.createElement(c.bL,{isOpen:C==="stage",onClose:()=>g(!1)},e.createElement(c.hE,null,s({id:"Settings.review-workflows.create.page.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})),e.createElement(c.nB,null,s({id:"Settings.review-workflows.create.page.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."}))))}function Z(){const s=(0,u.d4)(B.G);return e.createElement(i.kz,{permissions:s.settings["review-workflows"].create},e.createElement(X,null))}}}]);
