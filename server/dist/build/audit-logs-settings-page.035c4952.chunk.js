"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[5606],{289:(O,p,t)=>{t.d(p,{F:()=>v});var e=t(78320),n=t(75942);function v(f={},M={}){const{id:h="",...c}=f,{get:S}=(0,e.ry)(),{data:E,isError:P,isLoading:y,refetch:C}=(0,n.useQuery)(["users",h,c],async()=>{const{data:{data:R}}=await S(`/admin/users/${h}`,{params:c});return R},M);let A=[];return h&&E?A=[E]:Array.isArray(E?.results)&&(A=E.results),{users:A,pagination:E?.pagination??null,isLoading:y,isError:P,refetch:C}}},2976:(O,p,t)=>{t.d(p,{A:()=>P});var e=t(96540),n=t(91616),v=t(90954),f=t(78320),M=t(30195),h=t(5556),c=t.n(h),S=t(6442);const E=({displayedFilters:y})=>{const[C,A]=(0,e.useState)(!1),{formatMessage:R}=(0,S.A)(),b=(0,e.useRef)(),j=()=>{A(N=>!N)};return e.createElement(e.Fragment,null,e.createElement(n.a,{paddingTop:1,paddingBottom:1},e.createElement(v.$,{variant:"tertiary",ref:b,startIcon:e.createElement(M.A,null),onClick:j,size:"S"},R({id:"app.utils.filters",defaultMessage:"Filters"})),C&&e.createElement(f.LC,{displayedFilters:y,isVisible:C,onToggle:j,source:b})),e.createElement(f.cZ,{filtersSchema:y}))};E.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired};const P=E},34867:(O,p,t)=>{t.r(p),t.d(p,{default:()=>ve});var e=t(96540),n=t(78320),v=t(69733),f=t(71526),M=t(63214),h=t(40121),c=t(91616),S=t(71808),E=t(7562),P=t(96492),y=t(6442),C=t(2976),A=t(75942),R=t(56347),b=t(289);const N=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,n.ry)(),{search:i}=(0,R.zy)(),m=(0,n.hN)(),[{query:l}]=(0,n.sq)(),s={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:L=>m({type:"warning",message:L.message})},{users:r,isError:g,isLoading:T}=(0,b.F)({},{...s,enabled:d,staleTime:2*(1e3*60)}),{data:D,isLoading:F,isError:x}=(0,A.useQuery)(["auditLogs",i],async()=>{const{data:L}=await u("/admin/audit-logs",{params:l});return L},{...s,enabled:a});return{auditLogs:D,users:r,isLoading:T||F,hasError:x||g}};var w=t(75056),k=t(91267),q=t(43418),_=t(67066),ee=t(95998),te=t(5556),o=t.n(te),ae=t(1806);const z=()=>{const{formatDate:a}=(0,y.A)();return u=>{const i=(0,ae.A)(u),m=a(i,{dateStyle:"long"}),l=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${l}`}};var U=t(98016),se=t(10457),I=t(97939),ne=t(96630),oe=t(72670);const G={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},$=a=>G[a]||a,Q=({actionLabel:a,actionName:d})=>e.createElement(U.s,{direction:"column",alignItems:"baseline",gap:1},e.createElement(I.o,{textColor:"neutral600",variant:"sigma"},a),e.createElement(I.o,{textColor:"neutral600"},d));Q.propTypes={actionLabel:o().string.isRequired,actionName:o().string.isRequired};const B=Q,K=({status:a,data:d,formattedDate:u})=>{const{formatMessage:i}=(0,y.A)();if(a==="loading")return e.createElement(U.s,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:m,user:l,payload:s}=d;return e.createElement(e.Fragment,null,e.createElement(c.a,{marginBottom:3},e.createElement(I.o,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.x,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(B,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:$(m)},{model:s?.model})}),e.createElement(B,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(B,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:l?.displayName||"-"}),e.createElement(B,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:l?.id.toString()||"-"})),e.createElement(oe.j,{value:JSON.stringify(s,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};K.defaultProps={data:{}},K.propTypes={status:o().oneOf(["idle","loading","error","success"]).isRequired,data:o().shape({action:o().string,date:o().string,payload:o().object,user:o().object}),formattedDate:o().string.isRequired};const ie=K,J=({handleClose:a,logId:d})=>{const{get:u}=(0,n.ry)(),i=(0,n.hN)(),m=async T=>{const{data:D}=await u(`/admin/audit-logs/${T}`);if(!D)throw new Error("Audit log not found");return D},{data:l,status:s}=(0,A.useQuery)(["audit-log",d],()=>m(d),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),r=z(),g=l?r(l.date):"";return e.createElement(w.k,{onClose:a,labelledBy:"title"},e.createElement(k.r,null,e.createElement(_.B,{label:g,id:"title"},e.createElement(ee.m,{isCurrent:!0},g))),e.createElement(q.c,null,e.createElement(ie,{status:s,data:l,formattedDate:g})))};J.propTypes={handleClose:o().func.isRequired,logId:o().string.isRequired};const re=J,W=({pagination:a})=>e.createElement(c.a,{paddingTop:4},e.createElement(U.s,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(n._u,null),e.createElement(n.W7,{pagination:a})));W.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},W.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};const le=W;var de=t(88920),me=t(15912),Y=t(69782),ue=t(63292),ce=t(89376);const V=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:i}=(0,y.A)(),m=z(),l=({type:s,value:r,model:g})=>s==="date"?m(r):s==="action"?i({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:$(r)},{model:g}):r||"-";return e.createElement(de.N,null,d.map(s=>e.createElement(me.Tr,{key:s.id,...(0,n.qM)({fn:()=>u(s.id)})},a.map(({key:r,name:g,cellFormatter:T})=>e.createElement(Y.Td,{key:r},e.createElement(I.o,{textColor:"neutral800"},l({type:r,value:T?T(s[g]):s[g],model:s.payload?.model})))),e.createElement(Y.Td,{...n.dG},e.createElement(U.s,{justifyContent:"end"},e.createElement(ue.K,{onClick:()=>u(s.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${s.action} action`}),noBorder:!0,icon:e.createElement(ce.A,null)}))))))};V.defaultProps={rows:[]},V.propTypes={headers:o().array.isRequired,rows:o().array,onOpenModal:o().func.isRequired};const ge=V;var pe=t(64040),fe=t(60985);const H=({value:a,options:d,onChange:u})=>{const{formatMessage:i}=(0,y.A)(),m=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.G3,{"aria-label":m,value:a,onChange:u},d.map(({label:l,customValue:s})=>e.createElement(fe.j,{key:s,value:s},l)))};H.defaultProps={value:null},H.propTypes={value:o().string,options:o().arrayOf(o().shape({label:o().string.isRequired,customValue:o().string.isRequired}).isRequired).isRequired,onChange:o().func.isRequired};const X=H,Z=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],Ee=({formatMessage:a,users:d,canReadUsers:u})=>{const i=Object.keys(G).map(l=>({label:a({id:`Settings.permissions.auditLogs.${l}`,defaultMessage:$(l)},{model:void 0}),customValue:l})),m=[{name:"action",metadatas:{customOperators:Z,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:X},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const l=r=>r.username?r.username:r.firstname&&r.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,s=d.map(r=>({label:l(r),customValue:r.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:Z,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:s,customInput:X},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,y.A)(),d=(0,v.d4)(f.G),{allowedActions:{canRead:u,canReadUsers:i}}=(0,n.ec)({...d.settings.auditLogs,readUsers:d.settings.users.read}),[{query:m},l]=(0,n.sq)(),{auditLogs:s,users:r,isLoading:g,hasError:T}=N({canReadAuditLogs:u,canReadUsers:i});(0,n.L4)();const D=Ee({formatMessage:a,users:r,canReadUsers:i}),F=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),x=ye.map(L=>({...L,metadatas:{...L.metadatas,label:a(L.metadatas.label)}}));return T?e.createElement(M.P,null,e.createElement(h.s,null,e.createElement(c.a,{paddingTop:8},e.createElement(n.hH,null)))):e.createElement(S.g,{"aria-busy":g},e.createElement(n.x7,{name:F}),e.createElement(E.Q,{title:F,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(P.B,{startActions:e.createElement(C.A,{displayedFilters:D})}),e.createElement(h.s,{canRead:u},e.createElement(n.Ee,{contentType:"Audit logs",headers:x,rows:s?.results||[],withBulkActions:!0,isLoading:g},e.createElement(ge,{headers:x,rows:s?.results||[],onOpenModal:L=>l({id:L})})),e.createElement(le,{pagination:s?.pagination})),m?.id&&e.createElement(re,{handleClose:()=>l({id:null},"remove"),logId:m.id}))},ve=()=>{const a=(0,v.d4)(f.G);return e.createElement(n.kz,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},60985:(O,p,t)=>{t.d(p,{j:()=>n});var e=t(64040);const n=e.c$},96492:(O,p,t)=>{t.d(p,{B:()=>v});var e=t(74848),n=t(98016);const v=({startActions:f,endActions:M})=>!f&&!M?null:(0,e.jsxs)(n.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(n.s,{gap:2,wrap:"wrap",children:f}),(0,e.jsx)(n.s,{gap:2,shrink:0,wrap:"wrap",children:M})]})}}]);
