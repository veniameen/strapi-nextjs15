"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[9298],{289:(B,m,e)=>{e.d(m,{F:()=>n});var t=e(78320),a=e(75942);function n(i={},p={}){const{id:o="",...s}=i,{get:g}=(0,t.ry)(),{data:r,isError:l,isLoading:d,refetch:f}=(0,a.useQuery)(["users",o,s],async()=>{const{data:{data:P}}=await g(`/admin/users/${o}`,{params:s});return P},p);let M=[];return o&&r?M=[r]:Array.isArray(r?.results)&&(M=r.results),{users:M,pagination:r?.pagination??null,isLoading:d,isError:l,refetch:f}}},86209:(B,m,e)=>{e.r(m),e.d(m,{default:()=>le});var t=e(96540),a=e(78320),n=e(69733),i=e(56347),p=e(71526),o=e(71808),s=e(7562),g=e(90954),r=e(40121),l=e(91616),d=e(98016),f=e(97939),M=e(96630),P=e(16473),y=e(26437),W=e(40009),R=e(7425),C=e(58156),z=e.n(C),Y=e(90179),F=e.n(Y),$=e(44383),L=e.n($),G=e(5556),Q=e.n(G),H=e(6442),V=e(289),X=e(74090),v=e(14879),b=e(26123),te=e(94844),ae=e(85842),se=e(84241);const ne=async(D,u)=>{const{put:T}=(0,a.GD)(),{data:U}=await T(`/admin/users/${D}`,u);return U.data},oe=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],w=["email","firstname","lastname","username","isActive","roles"],k=({canUpdate:D})=>{const{formatMessage:u}=(0,H.A)(),{params:{id:T}}=(0,i.W5)("/settings/users/:id"),{push:U}=(0,i.W6)(),{setUserDisplayName:K}=(0,a.Xe)(),h=(0,a.hN)(),{lockApp:Z,unlockApp:J}=(0,a.MA)(),q=(0,X.h)(te.g,async()=>(await e.e(9034).then(e.bind(e,69034))).MagicLinkEE);(0,a.L4)();const{users:[x],isLoading:ie}=(0,V.F)({id:T},{cacheTime:0,onError(c){const{status:E}=c.response;E===403?(h({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),U("/")):h({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),de=async(c,E)=>{Z();try{const A=await ne(T,F()(c,"confirmPassword"));h({type:"success",message:u({id:"notification.success.saved",defaultMessage:"Saved"})});const I=a.j2.getUserInfo();if(T.toString()===I.id.toString()){a.j2.setUserInfo(A);const S=z()(c,"username")||(0,b.d)(c.firstname,c.lastname);K(S)}E.setValues(L()(c,w))}catch(A){const I=(0,v.N)(A.response.data),S=Object.keys(I).reduce((N,O)=>(N[O]=I[O].id,N),{});E.setErrors(S),h({type:"warning",message:z()(A,"response.data.error.message","notification.error")})}J()},_=ie||!q,ce=_?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},j=Object.keys(L()(x,w)).reduce((c,E)=>E==="roles"?(c[E]=(x?.roles||[]).map(({id:A})=>A),c):(c[E]=x?.[E],c),{}),me=j.username||(0,b.d)(j.firstname,j.lastname),ee=u(ce,{name:me});return _?t.createElement(o.g,{"aria-busy":"true"},t.createElement(a.x7,{name:"Users"}),t.createElement(s.Q,{primaryAction:t.createElement(g.$,{disabled:!0,startIcon:t.createElement(y.A,null),type:"button",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:ee,navigationAction:t.createElement(a.N_,{startIcon:t.createElement(W.A,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(r.s,null,t.createElement(a.Bl,null))):t.createElement(o.g,null,t.createElement(a.x7,{name:"Users"}),t.createElement(R.l1,{onSubmit:de,initialValues:j,validateOnChange:!1,validationSchema:se.Gd},({errors:c,values:E,handleChange:A,isSubmitting:I,dirty:S})=>t.createElement(a.lV,null,t.createElement(s.Q,{primaryAction:t.createElement(g.$,{disabled:I||!D?!0:!S,startIcon:t.createElement(y.A,null),loading:I,type:"submit",size:"L"},u({id:"global.save",defaultMessage:"Save"})),title:ee,navigationAction:t.createElement(a.N_,{startIcon:t.createElement(W.A,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},u({id:"global.back",defaultMessage:"Back"}))}),t.createElement(r.s,null,x?.registrationToken&&t.createElement(l.a,{paddingBottom:6},t.createElement(q,{registrationToken:x.registrationToken})),t.createElement(d.s,{direction:"column",alignItems:"stretch",gap:7},t.createElement(l.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(d.s,{direction:"column",alignItems:"stretch",gap:4},t.createElement(f.o,{variant:"delta",as:"h2"},u({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(M.x,{gap:5},oe.map(N=>N.map(O=>t.createElement(P.E,{key:O.name,...O.size},t.createElement(a.ah,{...O,disabled:!D,error:c[O.name],onChange:A,value:E[O.name]||""}))))))),t.createElement(l.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(d.s,{direction:"column",alignItems:"stretch",gap:4},t.createElement(f.o,{variant:"delta",as:"h2"},u({id:"global.roles",defaultMessage:"User's role"})),t.createElement(M.x,{gap:5},t.createElement(P.E,{col:6,xs:12},t.createElement(ae.A,{disabled:!D,error:c.roles,onChange:A,value:E.roles}))))))))))};k.propTypes={canUpdate:Q().bool.isRequired};const re=k,le=()=>{const D=(0,a.hN)(),u=(0,n.d4)(p.G),T=t.useMemo(()=>({read:u.settings.users.read,update:u.settings.users.update}),[u.settings.users]),{isLoading:U,allowedActions:{canRead:K,canUpdate:h}}=(0,a.ec)(T),{state:Z}=(0,i.zy)(),J=Z?.from??"/";return(0,t.useEffect)(()=>{U||!K&&!h&&D({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[U,K,h,D]),U?t.createElement(a.Bl,null):!K&&!h?t.createElement(i.rd,{to:J}):t.createElement(re,{canUpdate:h})}},16888:(B,m,e)=>{e.d(m,{A:()=>r});var t=e(96540),a=e(63292),n=e(78320),i=e(49464),p=e(5556),o=e.n(p),s=e(6442);const g=({children:l,target:d})=>{const f=(0,n.hN)(),{formatMessage:M}=(0,s.A)(),{copy:P}=(0,n.iD)(),y=M({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),W=async()=>{await P(d)&&f({type:"info",message:{id:"notification.link-copied"}})};return t.createElement(n.bQ,{endAction:t.createElement(a.K,{label:y,noBorder:!0,icon:t.createElement(i.A,null),onClick:W}),title:d,titleEllipsis:!0,subtitle:l,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};g.propTypes={children:o().oneOfType([o().element,o().string]).isRequired,target:o().string.isRequired};const r=g},94844:(B,m,e)=>{e.d(m,{g:()=>s});var t=e(96540),a=e(5556),n=e.n(a),i=e(6442),p=e(13275),o=e(16888);const s=({registrationToken:g})=>{const{formatMessage:r}=(0,i.A)(),l=`${window.location.origin}${p.A}auth/register?registrationToken=${g}`;return t.createElement(o.A,{target:l},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};s.defaultProps={registrationToken:""},s.propTypes={registrationToken:n().string}},85842:(B,m,e)=>{e.d(m,{A:()=>W});var t=e(96540),a=e(15074),n=e(62431),i=e(78320),p=e(24046),o=e(5556),s=e.n(o),g=e(6442),r=e(75942),l=e(40948);const d=(0,l.i7)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,f=l.Ay.div`
  animation: ${d} 2s infinite linear;
`,M=()=>t.createElement(f,null,t.createElement(p.A,null)),P=async()=>{const{get:R}=(0,i.GD)(),{data:C}=await R("/admin/roles");return C.data},y=({disabled:R,error:C,onChange:z,value:Y})=>{const{status:F,data:$}=(0,r.useQuery)(["roles"],P,{staleTime:5e4}),{formatMessage:L}=(0,g.A)(),G=C?L({id:C,defaultMessage:C}):"",Q=L({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),H=L({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),V=L({id:"app.components.Select.placeholder",defaultMessage:"Select"}),X=F==="loading"?t.createElement(M,null):void 0;return t.createElement(a.l,{id:"roles",disabled:R,error:G,hint:H,label:Q,name:"roles",onChange:v=>{z({target:{name:"roles",value:v}})},placeholder:V,multi:!0,startIcon:X,value:Y.map(v=>v.toString()),withTags:!0,required:!0},($||[]).map(v=>t.createElement(n.c,{key:v.id,value:v.id.toString()},L({id:`global.${v.code}`,defaultMessage:v.name}))))};y.defaultProps={disabled:!1,error:void 0},y.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired};const W=y},84241:(B,m,e)=>{e.d(m,{Gd:()=>r,pK:()=>p});var t=e(20627),a=e(78320);const n={firstname:t.Yj().trim().required(a.iW.required),lastname:t.Yj(),email:t.Yj().email(a.iW.email).lowercase().required(a.iW.required),username:t.Yj().nullable(),password:t.Yj().min(8,a.iW.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Yj().min(8,a.iW.minLength).oneOf([t.KR("password"),null],"components.Input.error.password.noMatch").when("password",(l,d)=>l?d.required(a.iW.required):d)},p={...n,currentPassword:t.Yj().when(["password","confirmPassword"],(l,d,f)=>l||d?f.required(a.iW.required):f),preferedLanguage:t.Yj().nullable()},s={roles:t.YO().min(1,a.iW.required).required(a.iW.required)},r=t.Ik().shape({...n,isActive:t.lc(),...s})},40009:(B,m,e)=>{e.d(m,{A:()=>n});var t=e(74848);const a=i=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...i,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),n=a}}]);
