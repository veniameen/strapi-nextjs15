"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[3881],{67070:(H,f,t)=>{t.d(f,{A:()=>le});var e=t(96540),P=t(2670),g=t(98016),v=t(86612),U=t(10457),X=t(1328),x=t(92582),l=t(84300),ne=t(69688),ae=t(97939),N=t(39134),G=t(64200),T=t(45073),Q=t(7425),ie=t(5556),M=t.n(ie),Y=t(6442),D=t(40948),de=t(30420);const E=n=>n.reduce((o,c)=>{const C=c.split(".")[0];return o[C]||(o[C]=[]),o[C].push(c),o},{}),k=(0,D.Ay)(P.X)`
  tbody tr:nth-child(odd) {
    background: ${({theme:n})=>n.colors.neutral100};
  }

  thead th span {
    color: ${({theme:n})=>n.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:n})=>n.spaces[3]};
    padding-block-end: ${({theme:n})=>n.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:n})=>n.spaces[2]};
  }
`,re=n=>{const o=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return n&&(o.push({id:"app.utils.publish",defaultMessage:"Publish"}),o.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),o},Z=n=>{const o=["entry.create","entry.update","entry.delete"];return n&&o.push("entry.publish","entry.unpublish"),{entry:o,media:["media.create","media.update","media.delete"]}},J=e.createContext(),oe=({children:n})=>{const{formatMessage:o}=(0,Y.A)(),{collectionTypes:c,isLoading:C}=(0,de.m)(),u=e.useMemo(()=>c.some(R=>R.options.draftAndPublish===!0),[c]),L=o({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(J.Provider,{value:{isDraftAndPublish:u}},e.createElement(g.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(v.d,{"aria-hidden":!0},L),C&&e.createElement(U.a,null,o({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(k,{"aria-label":L},n)))};oe.propTypes={children:M().oneOfType([M().arrayOf(M().node),M().node]).isRequired};const q=({getHeaders:n=re})=>{const{isDraftAndPublish:o}=e.useContext(J),{formatMessage:c}=(0,Y.A)(),C=n(o);return e.createElement(X.r,null,e.createElement(x.N,null,e.createElement(l.e,null,e.createElement(ne.s,null,c({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),C.map(u=>["app.utils.publish","app.utils.unpublish"].includes(u.id)?e.createElement(l.e,{key:u.id,title:c({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(ae.o,{variant:"sigma",textColor:"neutral600"},c(u))):e.createElement(l.e,{key:u.id},e.createElement(ae.o,{variant:"sigma",textColor:"neutral600"},c(u))))))};q.defaultProps={getHeaders:re},q.propTypes={getHeaders:M().func};const ee=({providedEvents:n})=>{const{isDraftAndPublish:o}=e.useContext(J),c=n||Z(o),{values:C,handleChange:u}=(0,Q.j7)(),L="events",R=C.events,_=[],K=E(R),W=({target:{name:y,value:m}})=>{let O=new Set(R);m?O.add(y):O.delete(y),u({target:{name:L,value:Array.from(O)}})},w=({target:{name:y,value:m}})=>{let O=new Set(R);m?c[y].forEach(A=>{_.includes(A)||O.add(A)}):c[y].forEach(A=>O.delete(A)),u({target:{name:L,value:Array.from(O)}})};return e.createElement(N.f,null,Object.entries(c).map(([y,m])=>e.createElement(F,{disabledEvents:_,key:y,name:y,events:m,inputValue:K[y],handleSelect:W,handleSelectAll:w})))};ee.defaultProps={providedEvents:null},ee.propTypes={providedEvents:M().object};const ce=n=>n.replace(/-/g," ").split(" ").map(o=>o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()).join(" "),F=({disabledEvents:n,name:o,events:c,inputValue:C,handleSelect:u,handleSelectAll:L})=>{const{formatMessage:R}=(0,Y.A)(),_=c.filter(m=>!n.includes(m)),K=C.length>0,W=C.length===_.length,w=({target:{name:m}})=>{L({target:{name:m,value:!W}})},y=5;return e.createElement(x.N,null,e.createElement(l.N,null,e.createElement(G.S,{indeterminate:K&&!W,"aria-label":R({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:o,onChange:w,value:W},ce(o))),c.map(m=>e.createElement(l.N,{key:m},e.createElement(T.J,{disabled:n.includes(m),"aria-label":m,name:m,value:C.includes(m),onValueChange:O=>u({target:{name:m,value:O}})}))),c.length<y&&e.createElement(l.N,{colSpan:y-c.length}))};F.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},F.propTypes={disabledEvents:M().array,events:M().array,inputValue:M().array,handleSelect:M().func,handleSelectAll:M().func,name:M().string.isRequired};const le={Root:oe,Headers:q,Body:ee,EventRow:F}},45944:(H,f,t)=>{t.d(f,{A:()=>fe});var e=t(96540),P=t(71808),g=t(78320),v=t(75942),U=t(56347),X=t(30420),x=t(7562),l=t(98016),ne=t(90954),ae=t(40121),N=t(91616),G=t(96630),T=t(16473),Q=t(30524),ie=t(37259),M=t(26437),Y=t(40009),D=t(7425),de=t(5556),E=t.n(de),k=t(6442),re=t(74090),Z=t(67070);function J(){return e.createElement(Z.A.Root,null,e.createElement(Z.A.Headers,null),e.createElement(Z.A.Body,null))}var oe=t(86612),q=t(4800),ee=t(68433),ce=t(64040),F=t(60985);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],n=({name:s,onChange:a,value:r,...d})=>{const{values:{headers:h}}=(0,D.j7)(),[b,i]=(0,e.useState)(le);(0,e.useEffect)(()=>{i(le.filter(p=>!h?.some(j=>j.key!==r&&j.key===p)))},[h,r]);const $=p=>{a({target:{name:s,value:p}})},z=p=>{i(j=>[...j,p]),$(p)};return e.createElement(ce.nP,{...d,onClear:()=>$(""),onChange:$,onCreateOption:z,placeholder:"",value:r},b.map(p=>e.createElement(F.j,{value:p,key:p},p)))};n.defaultProps={value:void 0},n.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};const o=n,C=()=>{const{formatMessage:s}=(0,k.A)(),{values:a,errors:r}=(0,D.j7)();return e.createElement(l.s,{direction:"column",alignItems:"stretch",gap:1},e.createElement(oe.d,null,s({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(N.a,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(D.ED,{validateOnChange:!1,name:"headers",render:({push:d,remove:h})=>e.createElement(G.x,{gap:4},a.headers.map((b,i)=>e.createElement(e.Fragment,{key:`${i}.${b.key}`},e.createElement(T.E,{col:6},e.createElement(D.D0,{as:o,name:`headers.${i}.key`,"aria-label":`row ${i+1} key`,label:s({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:r.headers?.[i]?.key&&r.headers[i].key})),e.createElement(T.E,{col:6},e.createElement(l.s,{alignItems:"flex-end"},e.createElement(N.a,{style:{flex:1}},e.createElement(D.D0,{as:Q.k,name:`headers.${i}.value`,"aria-label":`row ${i+1} value`,label:s({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:r.headers?.[i]?.value&&r.headers[i].value})),e.createElement(l.s,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:r.headers?.[i]?.value?0:5},e.createElement(g.yX,{disabled:a.headers.length===1,onClick:()=>h(i),label:s({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:i+1})})))))),e.createElement(T.E,{col:12},e.createElement(q.Q,{type:"button",onClick:()=>{d({key:"",value:""})},startIcon:e.createElement(ee.A,null)},s({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var u=t(97939),L=t(24046),R=t(9605),_=t(40948);const K=_.Ay.svg(({theme:s,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${s.colors[a]};
  }
`),W=({isPending:s,statusCode:a})=>{const{formatMessage:r}=(0,k.A)();return s?e.createElement(l.s,{gap:2,alignItems:"center"},e.createElement(K,{as:L.A}),e.createElement(u.o,null,r({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(l.s,{gap:2,alignItems:"center"},e.createElement(K,{as:M.A,color:"success700"}),e.createElement(u.o,null,r({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(l.s,{gap:2,alignItems:"center"},e.createElement(K,{as:R.A,color:"danger700"}),e.createElement(u.o,null,r({id:"Settings.error",defaultMessage:"error"})," ",a)):null};W.propTypes={isPending:E().bool.isRequired,statusCode:E().number},W.defaultProps={statusCode:void 0};const w=({statusCode:s,message:a})=>{const{formatMessage:r}=(0,k.A)();return s>=200&&s<300?e.createElement(l.s,{justifyContent:"flex-end"},e.createElement(u.o,{textColor:"neutral600",ellipsis:!0},r({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):s>=300?e.createElement(l.s,{justifyContent:"flex-end"},e.createElement(l.s,{maxWidth:(0,g.a8)(250),justifyContent:"flex-end",title:a},e.createElement(u.o,{ellipsis:!0,textColor:"neutral600"},a))):null};w.propTypes={statusCode:E().number,message:E().string},w.defaultProps={statusCode:void 0,message:void 0};const y=({onCancel:s})=>{const{formatMessage:a}=(0,k.A)();return e.createElement(l.s,{justifyContent:"flex-end"},e.createElement("button",{onClick:s,type:"button"},e.createElement(l.s,{gap:2,alignItems:"center"},e.createElement(u.o,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(K,{as:R.A,color:"neutral400"}))))};y.propTypes={onCancel:E().func.isRequired};const m=({isPending:s,onCancel:a,response:r})=>{const{statusCode:d,message:h}=r,{formatMessage:b}=(0,k.A)();return e.createElement(N.a,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(G.x,{gap:4,style:{alignItems:"center"}},e.createElement(T.E,{col:3},e.createElement(u.o,null,b({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(T.E,{col:3},e.createElement(W,{isPending:s,statusCode:d})),e.createElement(T.E,{col:6},s?e.createElement(y,{onCancel:a}):e.createElement(w,{statusCode:d,message:h}))))};m.defaultProps={isPending:!1,onCancel(){},response:{}},m.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};const O=m;var A=t(20627);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:s})=>A.Ik().shape({name:A.Yj().required(s({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,s({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:A.Yj().required(s({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,s({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:A.RZ(a=>{let r=A.YO();if(a.length===1){const{key:d,value:h}=a[0];if(!d&&!h)return r}return r.of(A.Ik().shape({key:A.Yj().required(s({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:A.Yj().required(s({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:A.YO()}),ue=({handleSubmit:s,triggerWebhook:a,isCreating:r,isTriggering:d,triggerResponse:h,data:b})=>{const{formatMessage:i}=(0,k.A)(),[$,z]=(0,e.useState)(!1),p=(0,re.h)(J,async()=>(await t.e(2785).then(t.bind(t,62785))).EventTableEE),j=B=>Object.keys(B).length?Object.entries(B).map(([te,se])=>({key:te,value:se})):[{key:"",value:""}],S=(0,D.Wx)({initialValues:{name:b?.name||"",url:b?.url||"",headers:j(b?.headers||{}),events:b?.events||[]},onSubmit(B,{resetForm:te,setSubmitting:se}){s(B),te({values:B}),se(!1)},validationSchema:he({formatMessage:i}),validateOnChange:!1,validateOnBlur:!1});return p?e.createElement(D.QI,{value:S},e.createElement(g.lV,{onSubmit:S.handleSubmit},e.createElement(x.Q,{primaryAction:e.createElement(l.s,{gap:2},e.createElement(ne.$,{onClick:()=>{a(),z(!0)},variant:"tertiary",startIcon:e.createElement(ie.A,null),disabled:r||d,size:"L"},i({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(ne.$,{startIcon:e.createElement(M.A,null),type:"submit",size:"L",disabled:!S.dirty,loading:S.isSubmitting},i({id:"global.save",defaultMessage:"Save"}))),title:r?i({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):b?.name,navigationAction:e.createElement(g.N_,{startIcon:e.createElement(Y.A,null),to:"/settings/webhooks"},i({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ae.s,null,e.createElement(l.s,{direction:"column",alignItems:"stretch",gap:4},$&&e.createElement(O,{isPending:d,response:h,onCancel:()=>z(!1)}),e.createElement(N.a,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(l.s,{direction:"column",alignItems:"stretch",gap:6},e.createElement(G.x,{gap:6},e.createElement(T.E,{col:6},e.createElement(D.D0,{as:Q.k,name:"name",error:S?.errors?.name&&S.errors.name,label:i({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(T.E,{col:12},e.createElement(D.D0,{as:Q.k,name:"url",error:S?.errors?.url&&S.errors.url,label:i({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(C,null),e.createElement(p,null))))))):null};ue.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},ue.defaultProps={data:void 0,triggerResponse:void 0};const pe=ue,me=s=>({...s,headers:s.headers.reduce((a,{key:r,value:d})=>(r!==""&&(a[r]=d),a),{})}),fe=()=>{const{params:{id:s}}=(0,U.W5)("/settings/webhooks/:id"),a=s==="create",{replace:r}=(0,U.W6)(),d=(0,g.hN)(),{formatAPIError:h}=(0,g.wq)(),b=(0,v.useQueryClient)(),{isLoading:i}=(0,X.m)(),{put:$,get:z,post:p}=(0,g.ry)(),{isLoading:j,data:S,error:B}=(0,v.useQuery)(["webhooks",s],async()=>{const{data:{data:I}}=await z(`/admin/webhooks/${s}`);return I},{enabled:!a});e.useEffect(()=>{B&&d({type:"warning",message:h(B)})},[B,d,h]);const{isLoading:te,data:se,isIdle:ve,mutate:Me}=(0,v.useMutation)(()=>p(`/admin/webhooks/${s}/trigger`)),Ce=()=>Me(null,{onError(I){d({type:"warning",message:h(I)})}}),ye=(0,v.useMutation)(I=>p("/admin/webhooks",I)),Ae=(0,v.useMutation)(({id:I,body:V})=>$(`/admin/webhooks/${I}`,V)),Pe=async I=>{if(a){ye.mutate(me(I),{onSuccess({data:V}){d({type:"success",message:{id:"Settings.webhooks.created"}}),r(`/settings/webhooks/${V.data.id}`)},onError(V){d({type:"warning",message:h(V)})}});return}Ae.mutate({id:s,body:me(I)},{onSuccess(){b.invalidateQueries(["webhooks",s]),d({type:"success",message:{id:"notification.form.success.fields"}})},onError(V){d({type:"warning",message:h(V)})}})};return j||i?e.createElement(g.Bl,null):e.createElement(P.g,null,e.createElement(g.x7,{name:"Webhooks"}),e.createElement(pe,{data:S,handleSubmit:Pe,triggerWebhook:Ce,isCreating:a,isTriggering:te,isTriggerIdle:ve,triggerResponse:se?.data.data}))}},31479:(H,f,t)=>{t.r(f),t.d(f,{default:()=>x});var e=t(96540),P=t(78320),g=t(69733),v=t(71526),U=t(45944);const x=()=>{const l=(0,g.d4)(v.G);return e.createElement(P.kz,{permissions:l.settings.webhooks.create},e.createElement(U.A,null))}},83807:(H,f,t)=>{t.r(f),t.d(f,{default:()=>x});var e=t(96540),P=t(78320),g=t(69733),v=t(71526),U=t(45944);const x=()=>{const l=(0,g.d4)(v.G);return e.createElement(P.kz,{permissions:l.settings.webhooks.update},e.createElement(U.A,null))}},60985:(H,f,t)=>{t.d(f,{j:()=>P});var e=t(64040);const P=e.c$},40009:(H,f,t)=>{t.d(f,{A:()=>g});var e=t(74848);const P=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),g=P},37259:(H,f,t)=>{t.d(f,{A:()=>g});var e=t(74848);const P=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 8 8",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M2 .93c0-.4.45-.63.78-.41l4.6 3.06c.3.2.3.64 0 .84l-4.6 3.06A.5.5 0 0 1 2 7.07V.93Z"})}),g=P}}]);
