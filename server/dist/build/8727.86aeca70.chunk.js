(self.webpackChunkserver=self.webpackChunkserver||[]).push([[8727],{19595:(v,m,e)=>{"use strict";e.d(m,{A:()=>h});var t=e(96540),c=e(7562),r=e(98016),o=e(90954),a=e(78320),i=e(26437),u=e(40009),y=e(5556),s=e.n(y),A=e(6442),C=e(67954),n=e(33878);const d=({onRegenerate:T,idToRegenerate:R,backUrl:W,onError:$})=>{const{formatMessage:S}=(0,A.A)(),[P,k]=(0,t.useState)(!1),{regenerateData:I,isLoadingConfirmation:V}=(0,n.g4)(W,R,T,$),K=async()=>{I(),k(!1)};return t.createElement(t.Fragment,null,t.createElement(o.$,{startIcon:t.createElement(C.A,null),type:"button",size:"S",variant:"tertiary",onClick:()=>k(!0),name:"regenerate"},S({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(a.TM,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(C.A,null),isConfirmButtonLoading:V,isOpen:P,onToggleDialog:()=>k(!1),onConfirm:K,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};d.defaultProps={onRegenerate(){},onError:void 0},d.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const l=d,g=({title:T,token:R,setToken:W,canEditInputs:$,canRegenerate:S,isSubmitting:P,backUrl:k,regenerateUrl:I,onErrorRegenerate:V})=>{const{formatMessage:K}=(0,A.A)(),Q=X=>{W({...R,accessKey:X})};return t.createElement(c.Q,{title:R?.name||K(T),primaryAction:$?t.createElement(r.s,{gap:2},S&&R?.id&&t.createElement(l,{backUrl:I,onRegenerate:Q,idToRegenerate:R?.id,onError:V}),t.createElement(o.$,{disabled:P,loading:P,startIcon:t.createElement(i.A,null),type:"submit",size:"S"},K({id:"global.save",defaultMessage:"Save"}))):S&&R?.id&&t.createElement(l,{onRegenerate:Q,idToRegenerate:R?.id,backUrl:I}),navigationAction:t.createElement(a.N_,{startIcon:t.createElement(u.A,null),to:k},K({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};g.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},g.defaultProps={token:void 0,onErrorRegenerate:void 0};const h=g},91146:(v,m,e)=>{"use strict";e.d(m,{A:()=>A});var t=e(96540),c=e(15074),r=e(62431),o=e(97939),a=e(5556),i=e.n(a),u=e(6442),y=e(31713);const s=({token:C,errors:n,values:d,onChange:l,isCreating:g})=>{const{formatMessage:h}=(0,u.A)();return t.createElement(t.Fragment,null,t.createElement(c.l,{name:"lifespan",label:h({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:d.lifespan!==null?d.lifespan:"0",error:n.lifespan?h(n.lifespan?.id?n.lifespan:{id:n.lifespan,defaultMessage:n.lifespan}):null,onChange:T=>{l({target:{name:"lifespan",value:T}})},required:!0,disabled:!g,placeholder:"Select"},t.createElement(r.c,{value:"604800000"},h({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(r.c,{value:"2592000000"},h({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(r.c,{value:"7776000000"},h({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(r.c,{value:"0"},h({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(o.o,{variant:"pi",textColor:"neutral600"},!g&&`${h({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,y.N1)(C?.createdAt,parseInt(d.lifespan,10))}`))};s.propTypes={errors:i().shape({lifespan:i().string}),onChange:i().func.isRequired,values:i().shape({lifespan:i().oneOfType([i().number,i().string])}).isRequired,isCreating:i().bool.isRequired,token:i().shape({id:i().oneOfType([i().number,i().string]),type:i().string,lifespan:i().string,name:i().string,accessKey:i().string,permissions:i().array,description:i().string,createdAt:i().string})},s.defaultProps={errors:{},token:{}};const A=s},54134:(v,m,e)=>{"use strict";e.d(m,{A:()=>A});var t=e(96540),c=e(63292),r=e(78320),o=e(49464),a=e(37426),i=e(5556),u=e.n(i),y=e(6442);const s=({token:C,tokenType:n})=>{const{formatMessage:d}=(0,y.A)(),l=(0,r.hN)(),{trackUsage:g}=(0,r.z1)(),{copy:h}=(0,r.iD)(),T=R=>async()=>{await h(R)&&(g("didCopyTokenKey",{tokenType:n}),l({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(r.bQ,{endAction:C&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(c.K,{label:d({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:T(C),noBorder:!0,icon:t.createElement(o.A,null),style:{padding:0,height:"1rem"}})),title:C||d({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:d(C?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(a.A,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:u().string,tokenType:u().string.isRequired};const A=s},6937:(v,m,e)=>{"use strict";e.d(m,{A:()=>u});var t=e(96540),c=e(56046),r=e(5556),o=e.n(r),a=e(6442);const i=({errors:y,values:s,onChange:A,canEditInputs:C})=>{const{formatMessage:n}=(0,a.A)();return t.createElement(c.T,{label:n({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:y.description?n(y.description?.id?y.description:{id:y.description,defaultMessage:y.description}):null,onChange:A,disabled:!C},s.description)};i.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},28506:(v,m,e)=>{"use strict";e.d(m,{A:()=>u});var t=e(96540),c=e(30524),r=e(5556),o=e.n(r),a=e(6442);const i=({errors:y,values:s,onChange:A,canEditInputs:C})=>{const{formatMessage:n}=(0,a.A)();return t.createElement(c.k,{name:"name",error:y.name?n(y.name?.id?y.name:{id:y.name,defaultMessage:y.name}):null,label:n({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:A,value:s.name,disabled:!C,required:!0})};i.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},85021:(v,m,e)=>{"use strict";e.d(m,{A:()=>y});var t=e(96540),c=e(15074),r=e(62431),o=e(5556),a=e.n(o),i=e(6442);const u=({name:s,errors:A,values:C,onChange:n,canEditInputs:d,options:l,label:g})=>{const{formatMessage:h}=(0,i.A)();return t.createElement(c.l,{name:s,label:h({id:g.id,defaultMessage:g.defaultMessage}),value:C&&C[s],error:A[s]?h(A[s]?.id?A[s]:{id:A[s],defaultMessage:A[s]}):null,onChange:n,placeholder:"Select",required:!0,disabled:!d},l&&l.map(({value:T,label:R})=>t.createElement(r.c,{key:T,value:T},h(R))))};u.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},u.defaultProps={name:"type",errors:{},options:[]};const y=u},55286:(v,m,e)=>{"use strict";e.d(m,{I:()=>t,j:()=>c});const t="api-token",c="transfer-token"},18727:(v,m,e)=>{"use strict";e.d(m,{A:()=>Ye});var t=e(96540),c=e(71808),r=e(40121),o=e(98016),a=e(78320),i=e(7425),u=e(6442),y=e(75942),s=e(69733),A=e(56347),C=e(5556),n=e.n(C);const d=(0,t.createContext)({}),l=({children:p,...E})=>t.createElement(d.Provider,{value:E},p),g=()=>(0,t.useContext)(d);l.propTypes={children:n().node.isRequired};var h=e(14879),T=e(71526),R=e(55286),W=e(19595),$=e(54134),S=e(91616),P=e(97939),k=e(96630),I=e(16473),V=e(91146),K=e(6937),Q=e(28506),X=e(85021);const Z=({errors:p,onChange:E,canEditInputs:f,isCreating:D,values:x,apiToken:L,onDispatch:O,setHasChangedPermissions:G})=>{const{formatMessage:F}=(0,u.A)(),z=({target:{value:H}})=>{G(!1),H==="full-access"&&O({type:"SELECT_ALL_ACTIONS"}),H==="read-only"&&O({type:"ON_CHANGE_READ_ONLY"})},w=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return t.createElement(S.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:4},t.createElement(P.o,{variant:"delta",as:"h2"},F({id:"global.details",defaultMessage:"Details"})),t.createElement(k.x,{gap:5},t.createElement(I.E,{key:"name",col:6,xs:12},t.createElement(Q.A,{errors:p,values:x,canEditInputs:f,onChange:E})),t.createElement(I.E,{key:"description",col:6,xs:12},t.createElement(K.A,{errors:p,values:x,canEditInputs:f,onChange:E})),t.createElement(I.E,{key:"lifespan",col:6,xs:12},t.createElement(V.A,{isCreating:D,errors:p,values:x,onChange:E,token:L})),t.createElement(I.E,{key:"type",col:6,xs:12},t.createElement(X.A,{values:x,errors:p,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:H=>{z({target:{value:H}}),E({target:{name:"type",value:H}})},options:w,canEditInputs:f})))))};Z.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},Z.defaultProps={errors:{},apiToken:{}};const J=Z;var ne=e(7562),le=e(90954),de=e(26437);const _=({apiTokenName:p})=>{const{formatMessage:E}=(0,u.A)();return(0,a.L4)(),t.createElement(c.g,{"aria-busy":"true"},t.createElement(a.x7,{name:"API Tokens"}),t.createElement(ne.Q,{primaryAction:t.createElement(le.$,{disabled:!0,startIcon:t.createElement(de.A,null),type:"button",size:"L"},E({id:"global.save",defaultMessage:"Save"})),title:p||E({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),t.createElement(r.s,null,t.createElement(a.Bl,null)))};_.defaultProps={apiTokenName:null},_.propTypes={apiTokenName:n().string};const ce=_;var se=e(55378),ae=e.n(se),oe=e(44384),Me=e.n(oe),re=e(40948);const Pe=p=>{switch(p){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},xe=(0,re.Ay)(S.a)`
  margin: -1px;
  border-radius: ${({theme:p})=>p.spaces[1]} 0 0 ${({theme:p})=>p.spaces[1]};
`;function pe({route:p}){const{formatMessage:E}=(0,u.A)(),{method:f,handler:D,path:x}=p,L=x?Me()(x.split("/")):[],[O="",G=""]=D?D.split("."):[],F=Pe(p.method);return t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.o,{variant:"delta",as:"h3"},E({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",t.createElement("span",null,O),t.createElement(P.o,{variant:"delta",textColor:"primary600"},".",G)),t.createElement(o.s,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},t.createElement(xe,{background:F.background,borderColor:F.border,padding:2},t.createElement(P.o,{fontWeight:"bold",textColor:F.text},f)),t.createElement(S.a,{paddingLeft:2,paddingRight:2},ae()(L,z=>t.createElement(P.o,{key:z,textColor:z.includes(":")?"neutral600":"neutral900"},"/",z)))))}pe.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},pe.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Oe=pe,Re=()=>{const{value:{selectedAction:p,routes:E}}=g(),{formatMessage:f}=(0,u.A)(),D=p?.split(".")[0];return t.createElement(I.E,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},p?t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:2},E[D]?.map(x=>x.config.auth?.scope?.includes(p)||x.handler===p?t.createElement(Oe,{key:x.handler,route:x}):null)):t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.o,{variant:"delta",as:"h3"},f({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),t.createElement(P.o,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Ie=e(82008),De=e(23845),Se=e(13203),Te=e(64200),Le=e(29754),Be=e(14792),ke=e.n(Be);const ve=(0,re.AH)`
  background: ${p=>p.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Ue=(0,re.Ay)(S.a)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${p=>p.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${p=>p.isActive&&ve}
  &:hover {
    ${ve}
  }
`,be=re.Ay.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:p})=>p.colors.neutral150};
`,ue=({controllers:p,label:E,orderNumber:f,disabled:D,onExpanded:x,indexExpandendCollapsedContent:L})=>{const{value:{onChangeSelectAll:O,onChange:G,selectedActions:F,setSelectedAction:z,selectedAction:w}}=g(),[H,ie]=(0,t.useState)(!1),{formatMessage:Ee}=(0,u.A)(),q=()=>{ie(B=>!B),x(f)};(0,t.useEffect)(()=>{L!==null&&L!==f&&H&&ie(!1)},[L,f,H]);const b=B=>B===w;return t.createElement(Ie.n,{expanded:H,onToggle:q,variant:f%2?"primary":"secondary"},t.createElement(De.P,{title:ke()(E)}),t.createElement(Se.u,null,p?.map(B=>{const ee=B.actions.every(N=>F.includes(N.actionId)),fe=B.actions.some(N=>F.includes(N.actionId));return t.createElement(S.a,{key:`${E}.${B?.controller}`},t.createElement(o.s,{justifyContent:"space-between",alignItems:"center",padding:4},t.createElement(S.a,{paddingRight:4},t.createElement(P.o,{variant:"sigma",textColor:"neutral600"},B?.controller)),t.createElement(be,null),t.createElement(S.a,{paddingLeft:4},t.createElement(Te.S,{value:ee,indeterminate:!ee&&fe,onValueChange:()=>{O({target:{value:[...B.actions]}})},disabled:D},Ee({id:"app.utils.select-all",defaultMessage:"Select all"})))),t.createElement(k.x,{gap:4,padding:4},B?.actions&&B?.actions.map(N=>t.createElement(I.E,{col:6,key:N.actionId},t.createElement(Ue,{isActive:b(N.actionId),padding:2,hasRadius:!0},t.createElement(Te.S,{value:F.includes(N.actionId),name:N.actionId,onValueChange:()=>{G({target:{value:N.actionId}})},disabled:D},N.action),t.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>z({target:{value:N.actionId}}),style:{display:"inline-flex",alignItems:"center"}},t.createElement(Le.A,null)))))))})))};ue.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ue.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const We=ue,ge=({section:p,...E})=>{const[f,D]=(0,t.useState)(null),x=L=>D(L);return t.createElement(S.a,{padding:4,background:"neutral0"},p&&p.map((L,O)=>t.createElement(We,{key:L.apiId,label:L.label,controllers:L.controllers,orderNumber:O,indexExpandendCollapsedContent:f,onExpanded:x,name:L.apiId,...E})))};ge.defaultProps={section:null},ge.propTypes={section:n().arrayOf(n().object)};const Ke=ge,Ne=({...p})=>{const{value:{data:E}}=g(),{formatMessage:f}=(0,u.A)();return t.createElement(k.x,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},t.createElement(I.E,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:2},t.createElement(P.o,{variant:"delta",as:"h2"},f({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),t.createElement(P.o,{as:"p",textColor:"neutral600"},f({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),E?.permissions&&t.createElement(Ke,{section:E?.permissions,...p})),t.createElement(Re,null))},$e=(0,t.memo)(Ne);var me=e(31713);const je=(p,E=[])=>({...p,selectedAction:null,routes:[],selectedActions:[],data:(0,me.z1)(E)});var Fe=e(41261),ze=e(50121),Ce=e.n(ze);const He={data:{},selectedActions:[]},Ve=(p,E)=>(0,Fe.Ay)(p,f=>{switch(E.type){case"ON_CHANGE":{f.selectedActions.includes(E.value)?Ce()(f.selectedActions,E.value):f.selectedActions.push(E.value);break}case"SELECT_ALL_IN_PERMISSION":{E.value.every(x=>f.selectedActions.includes(x.actionId))?E.value.forEach(x=>{Ce()(f.selectedActions,x.actionId)}):E.value.forEach(x=>{f.selectedActions.push(x.actionId)});break}case"SELECT_ALL_ACTIONS":{f.selectedActions=[...f.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const D=f.data.allActionsIds.filter(x=>x.includes("find")||x.includes("findOne"));f.selectedActions=[...D];break}case"UPDATE_PERMISSIONS_LAYOUT":{f.data=(0,me.z1)(E.value);break}case"UPDATE_ROUTES":{f.routes={...E.value};break}case"UPDATE_PERMISSIONS":{f.selectedActions=[...E.value];break}case"SET_SELECTED_ACTION":{f.selectedAction=E.value;break}default:return f}}),Ge="Name already taken",Ye=()=>{(0,a.L4)();const{formatMessage:p}=(0,u.A)(),{lockApp:E,unlockApp:f}=(0,a.MA)(),D=(0,a.hN)(),x=(0,A.W6)(),L=(0,s.d4)(T.G),[O,G]=(0,t.useState)(x.location.state?.apiToken.accessKey?{...x.location.state.apiToken}:null),{trackUsage:F}=(0,a.z1)(),z=(0,t.useRef)(F),{setCurrentStep:w}=(0,a.Cx)(),{allowedActions:{canCreate:H,canUpdate:ie,canRegenerate:Ee}}=(0,a.ec)(L.settings["api-tokens"]),[q,b]=(0,t.useReducer)(Ve,He,M=>je(M,{})),{params:{id:B}}=(0,A.W5)("/settings/api-tokens/:id"),{get:ee,post:fe,put:N}=(0,a.ry)(),j=B==="create";(0,y.useQuery)("content-api-permissions",async()=>{const[M,Y]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async te=>{const{data:U}=await ee(te);return U.data}));b({type:"UPDATE_PERMISSIONS_LAYOUT",value:M}),b({type:"UPDATE_ROUTES",value:Y}),O&&(O?.type==="read-only"&&b({type:"ON_CHANGE_READ_ONLY"}),O?.type==="full-access"&&b({type:"SELECT_ALL_ACTIONS"}),O?.type==="custom"&&b({type:"UPDATE_PERMISSIONS",value:O?.permissions}))},{onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,t.useEffect)(()=>{z.current(j?"didAddTokenFromList":"didEditTokenFromList",{tokenType:R.I})},[j]);const{status:Qe}=(0,y.useQuery)(["api-token",B],async()=>{const{data:{data:M}}=await ee(`/admin/api-tokens/${B}`);return G({...M}),M?.type==="read-only"&&b({type:"ON_CHANGE_READ_ONLY"}),M?.type==="full-access"&&b({type:"SELECT_ALL_ACTIONS"}),M?.type==="custom"&&b({type:"UPDATE_PERMISSIONS",value:M?.permissions}),M},{enabled:!j&&!O,onError(){D({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Xe=async(M,Y)=>{z.current(j?"willCreateToken":"willEditToken",{tokenType:R.I}),E();const te=M.lifespan&&parseInt(M.lifespan,10)&&M.lifespan!=="0"?parseInt(M.lifespan,10):null;try{const{data:{data:U}}=j?await fe("/admin/api-tokens",{...M,lifespan:te,permissions:M.type==="custom"?q.selectedActions:null}):await N(`/admin/api-tokens/${B}`,{name:M.name,description:M.description,type:M.type,permissions:M.type==="custom"?q.selectedActions:null});j&&(x.replace(`/settings/api-tokens/${U.id}`,{apiToken:U}),w("apiTokens.success")),f(),G({...U}),D({type:"success",message:p(j?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),z.current(j?"didCreateToken":"didEditToken",{type:O.type,tokenType:R.I})}catch(U){const Ae=(0,h.N)(U.response.data);Y.setErrors(Ae),U?.response?.data?.error?.message===Ge?D({type:"warning",message:U.response.data.message||"notification.error.tokennamenotunique"}):D({type:"warning",message:U?.response?.data?.message||"notification.error"}),f()}},[Je,ye]=(0,t.useState)(!1),Ze={...q,onChange:({target:{value:M}})=>{ye(!0),b({type:"ON_CHANGE",value:M})},onChangeSelectAll:({target:{value:M}})=>{ye(!0),b({type:"SELECT_ALL_IN_PERMISSION",value:M})},setSelectedAction:({target:{value:M}})=>{b({type:"SET_SELECTED_ACTION",value:M})}},he=ie&&!j||H&&j;return!j&&!O&&Qe!=="success"?t.createElement(ce,{apiTokenName:O?.name}):t.createElement(l,{value:Ze},t.createElement(c.g,null,t.createElement(a.x7,{name:"API Tokens"}),t.createElement(i.l1,{validationSchema:me.wQ,validateOnChange:!1,initialValues:{name:O?.name||"",description:O?.description||"",type:O?.type,lifespan:O?.lifespan?O.lifespan.toString():O?.lifespan},enableReinitialize:!0,onSubmit:(M,Y)=>Xe(M,Y)},({errors:M,handleChange:Y,isSubmitting:te,values:U,setFieldValue:Ae})=>(Je&&U?.type!=="custom"&&Ae("type","custom"),t.createElement(a.lV,null,t.createElement(W.A,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:O,setToken:G,canEditInputs:he,canRegenerate:Ee,isSubmitting:te,regenerateUrl:"/admin/api-tokens/"}),t.createElement(r.s,null,t.createElement(o.s,{direction:"column",alignItems:"stretch",gap:6},Boolean(O?.name)&&t.createElement($.A,{token:O?.accessKey,tokenType:R.I}),t.createElement(J,{errors:M,onChange:Y,canEditInputs:he,isCreating:j,values:U,apiToken:O,onDispatch:b,setHasChangedPermissions:ye}),t.createElement($e,{disabled:!he||U?.type==="read-only"||U?.type==="full-access"}))))))))}},31713:(v,m,e)=>{"use strict";e.d(m,{N1:()=>a,wQ:()=>s,z1:()=>C});var t=e(81207),c=e(92998),r=e(64123);const a=(n,d,l="en")=>{if(d&&typeof d=="number"){const g=d/24/60/60/1e3;return(0,t.A)((0,c.A)(new Date(n),g),"PPP",{locale:r[l]})}return"Unlimited"};var i=e(78320),u=e(20627);const s=u.Ik().shape({name:u.Yj(i.iW.string).max(100).required(i.iW.required),type:u.Yj(i.iW.string).oneOf(["read-only","full-access","custom"]).required(i.iW.required),description:u.Yj().nullable(),lifespan:u.ai().integer().min(0).nullable().defined(i.iW.required)}),C=n=>{const d={allActionsIds:[],permissions:[]};return d.permissions=Object.keys(n).map(l=>({apiId:l,label:l.split("::")[1],controllers:Object.keys(n[l].controllers).map(g=>({controller:g,actions:n[l].controllers[g].map(h=>{const T=`${l}.${g}.${h}`;return l.includes("api::")&&d.allActionsIds.push(T),{action:h,actionId:T}}).flat()})).flat()})),d}},2523:v=>{function m(e,t,c,r){for(var o=e.length,a=c+(r?1:-1);r?a--:++a<o;)if(t(e[a],a,e))return a;return-1}v.exports=m},96131:(v,m,e)=>{var t=e(2523),c=e(85463),r=e(76959);function o(a,i,u){return i===i?r(a,i,u):t(a,c,u)}v.exports=o},12027:v=>{function m(e,t,c,r){for(var o=c-1,a=e.length;++o<a;)if(r(e[o],t))return o;return-1}v.exports=m},85463:v=>{function m(e){return e!==e}v.exports=m},21988:(v,m,e)=>{var t=e(34932),c=e(96131),r=e(12027),o=e(27301),a=e(23007),i=Array.prototype,u=i.splice;function y(s,A,C,n){var d=n?r:c,l=-1,g=A.length,h=s;for(s===A&&(A=a(A)),C&&(h=t(s,o(C)));++l<g;)for(var T=0,R=A[l],W=C?C(R):R;(T=d(h,W,T,n))>-1;)h!==s&&u.call(h,T,1),u.call(s,T,1);return s}v.exports=y},76959:v=>{function m(e,t,c){for(var r=c-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}v.exports=m},55378:(v,m,e)=>{var t=e(34932),c=e(15389),r=e(5128),o=e(56449);function a(i,u){var y=o(i)?t:r;return y(i,c(u,3))}v.exports=a},50121:(v,m,e)=>{var t=e(69302),c=e(12358),r=t(c);v.exports=r},12358:(v,m,e)=>{var t=e(21988);function c(r,o){return r&&r.length&&o&&o.length?t(r,o):r}v.exports=c},44384:(v,m,e)=>{var t=e(25160);function c(r){var o=r==null?0:r.length;return o?t(r,1,o):[]}v.exports=c},82008:(v,m,e)=>{"use strict";e.d(m,{I:()=>A,n:()=>n});var t=e(74848),c=e(96540),r=e(40948),o=e(42349),a=e(28618),i=e(97939),u=e(98016),y=e(91616);const s=({theme:d,expanded:l,variant:g,disabled:h,error:T})=>T?`1px solid ${d.colors.danger600} !important`:h?`1px solid ${d.colors.neutral150}`:l?`1px solid ${d.colors.primary600}`:g==="primary"?`1px solid ${d.colors.neutral0}`:`1px solid ${d.colors.neutral100}`,A=(0,r.Ay)(i.o)``,C=(0,r.Ay)(y.a)`
  border: ${s};

  &:hover:not([aria-disabled='true']) {
    border: 1px solid ${({theme:d})=>d.colors.primary600};

    ${A} {
      color: ${({theme:d,expanded:l})=>l?void 0:d.colors.primary700};
    }

    ${i.o} {
      color: ${({theme:d,expanded:l})=>l?void 0:d.colors.primary600};
    }

    & > ${u.s} {
      background: ${({theme:d})=>d.colors.primary100};
    }

    [data-strapi-dropdown='true'] {
      background: ${({theme:d})=>d.colors.primary200};
    }
  }
`,n=({children:d,disabled:l=!1,error:g,expanded:h=!1,hasErrorMessage:T=!0,id:R,onToggle:W,toggle:$,size:S="M",variant:P="primary",shadow:k})=>{const I=(0,a.B)(R),V=c.useMemo(()=>({expanded:h,onToggle:W,toggle:$,id:I,size:S,variant:P,disabled:l}),[l,h,I,W,S,$,P]);return(0,t.jsxs)(o.C.Provider,{value:V,children:[(0,t.jsx)(C,{"data-strapi-expanded":h,disabled:l,"aria-disabled":l,expanded:h,hasRadius:!0,variant:P,error:g,shadow:k,children:d}),g&&T&&(0,t.jsx)(y.a,{paddingTop:1,children:(0,t.jsx)(i.o,{variant:"pi",textColor:"danger600",children:g})})]})}},13203:(v,m,e)=>{"use strict";e.d(m,{u:()=>o});var t=e(74848),c=e(42349),r=e(91616);const o=({children:a,...i})=>{const{expanded:u,id:y}=(0,c.O)();if(!u)return null;const s=`accordion-content-${y}`,A=`accordion-label-${y}`,C=`accordion-desc-${y}`;return(0,t.jsx)(r.a,{role:"region",id:s,"aria-labelledby":A,"aria-describedby":C,...i,children:a})}},42349:(v,m,e)=>{"use strict";e.d(m,{C:()=>c,O:()=>r});var t=e(96540);const c=(0,t.createContext)({disabled:!1,expanded:!1,id:"",size:"M",variant:"primary"}),r=()=>(0,t.useContext)(c)},23845:(v,m,e)=>{"use strict";e.d(m,{P:()=>d});var t=e(74848),c=e(77044),r=e(40948),o=e(82008),a=e(42349);const i=({expanded:l,disabled:g,variant:h})=>{let T="neutral100";return l?T="primary100":g?T="neutral150":h==="primary"&&(T="neutral0"),T};var u=e(4800),y=e(41240),s=e(98016),A=e(97939);const C=(0,r.Ay)(u.Q)`
  text-align: left;

  // necessary to make the ellipsis prop work on the title
  > span {
    max-width: 100%;
  }

  svg {
    width: ${14/16}rem;
    height: ${14/16}rem;

    path {
      fill: ${({theme:l,expanded:g})=>g?l.colors.primary600:l.colors.neutral500};
    }
  }
`,n=(0,r.Ay)(s.s)`
  min-height: ${({theme:l,size:g})=>l.sizes.accordions[g]};
  border-radius: ${({theme:l,expanded:g})=>g?`${l.borderRadius} ${l.borderRadius} 0 0`:l.borderRadius};

  &:hover {
    svg {
      path {
        fill: ${({theme:l})=>l.colors.primary600};
      }
    }
  }
`,d=({title:l,description:g,as:h="span",togglePosition:T="right",action:R,...W})=>{const{onToggle:$,toggle:S,expanded:P,id:k,size:I,variant:V,disabled:K}=(0,a.O)(),Q=`accordion-content-${k}`,X=`accordion-label-${k}`,Z=`accordion-desc-${k}`,J=I==="M"?6:4,ne=I==="M"?J:J-2,le=i({expanded:P,disabled:K,variant:V}),de={as:h,fontWeight:I==="S"?"bold":void 0,id:X,textColor:P?"primary600":"neutral700",ellipsis:!0,variant:I==="M"?"delta":void 0},_=P?"primary600":"neutral600",ce=P?"primary200":"neutral200",se=I==="M"?`${32/16}rem`:`${24/16}rem`,ae=()=>{K||(S&&!$?(console.warn('Deprecation warning: Usage of "toggle" prop in Accordion component is deprecated. This is discouraged and will be removed in the next major release. Please use "onToggle" instead'),S()):$&&$())},oe=(0,t.jsx)(s.s,{justifyContent:"center",borderRadius:"50%",height:se,width:se,transform:P?"rotate(180deg)":void 0,"data-strapi-dropdown":!0,"aria-hidden":!0,as:"span",background:ce,cursor:K?"not-allowed":"pointer",onClick:ae,shrink:0,children:(0,t.jsx)(y.I,{as:c.A,width:I==="M"?`${11/16}rem`:`${8/16}rem`,color:P?"primary600":"neutral600"})});return(0,t.jsx)(n,{paddingBottom:ne,paddingLeft:J,paddingRight:J,paddingTop:ne,background:le,expanded:P,size:I,justifyContent:"space-between",cursor:K?"not-allowed":"",children:(0,t.jsxs)(s.s,{gap:3,flex:1,maxWidth:"100%",children:[T==="left"&&oe,(0,t.jsx)(C,{onClick:ae,"aria-disabled":K,"aria-expanded":P,"aria-controls":Q,"aria-labelledby":X,"data-strapi-accordion-toggle":!0,expanded:P,type:"button",flex:1,minWidth:0,...W,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.I,{...de,children:l}),g&&(0,t.jsx)(A.o,{as:"p",id:Z,textColor:_,children:g})]})}),T==="right"&&(0,t.jsxs)(s.s,{gap:3,children:[oe,R]}),T==="left"&&R]})})}}}]);
